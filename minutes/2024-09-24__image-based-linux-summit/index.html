<!doctype html><html lang=en dir=ltr><head><meta name=generator content="Hugo 0.104.3"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ÔªøImage-Based Linux Summit Berlin 24th September 2024 # Attendee&rsquo;s projects # systemd mkosi SUSE: MicroOS/Tumbleweed Red Hat: image-builder/osbuild, bootc, systemd, systemd-boot Microsoft: confidential containers, Flatcar, Azure Boost, Mariner/Azure Linux Edgeless Systems: Constellation, Contrast (confidential containers), uplosi NixOS: systemd-{repart,stub,boot,cryptenroll}, tvix-store, Lanzaboote, UKIs, NixOS Bootspec, PE binary manipulation in Rust Canonical: Ubuntu Core, snaps, foundations/bootloader/package management System Transparency: UKI, UAPI specs, systemd-cryptenroll, remote attestation, TPM eventlog, mkosi Freedesktop-sdk GNOME OS Pengutronix: OE/Yocto, nspawn, RAUC, verity, OPTEE Arch Linux: sbctl/go-uefi, signstar, mkinitcpio, arch-install-scripts PostmarketOS Summary of Last Year‚Äôs Progress # Flatcar: Sysexts widely adopted: In-system (shipped with OS), optional but system dependent (updated in lock-step with OS, like podman/ZFS), Custom / user provided (updated from custom servers via sysupdate) Composable OS is more flexible, some traction with contributors, even vendors (Akamai) Mutable sysexts feature available in systemd-256 and newer."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content><meta property="og:description" content="ÔªøImage-Based Linux Summit Berlin 24th September 2024 # Attendee&rsquo;s projects # systemd mkosi SUSE: MicroOS/Tumbleweed Red Hat: image-builder/osbuild, bootc, systemd, systemd-boot Microsoft: confidential containers, Flatcar, Azure Boost, Mariner/Azure Linux Edgeless Systems: Constellation, Contrast (confidential containers), uplosi NixOS: systemd-{repart,stub,boot,cryptenroll}, tvix-store, Lanzaboote, UKIs, NixOS Bootspec, PE binary manipulation in Rust Canonical: Ubuntu Core, snaps, foundations/bootloader/package management System Transparency: UKI, UAPI specs, systemd-cryptenroll, remote attestation, TPM eventlog, mkosi Freedesktop-sdk GNOME OS Pengutronix: OE/Yocto, nspawn, RAUC, verity, OPTEE Arch Linux: sbctl/go-uefi, signstar, mkinitcpio, arch-install-scripts PostmarketOS Summary of Last Year‚Äôs Progress # Flatcar: Sysexts widely adopted: In-system (shipped with OS), optional but system dependent (updated in lock-step with OS, like podman/ZFS), Custom / user provided (updated from custom servers via sysupdate) Composable OS is more flexible, some traction with contributors, even vendors (Akamai) Mutable sysexts feature available in systemd-256 and newer."><meta property="og:type" content="article"><meta property="og:url" content="https://uapi-group.org/docs/minutes/2024-09-24__image-based-linux-summit/"><meta property="article:section" content="minutes"><title>2024 09 24 Image Based Linux Summit | UAPI group generic documents and meeting minutes</title><link rel=manifest href=/docs/manifest.json><link rel=icon href=/docs/favicon.png type=image/x-icon><link rel=stylesheet href=/docs/book.min.f716a89e40b01f033146ee402497165ac5bcf8935948094dceafbcb19f6f3c8d.css integrity="sha256-9xaonkCwHwMxRu5AJJcWWsW8+JNZSAlNzq+8sZ9vPI0="><script defer src=/docs/en.search.min.17a052fef665f49ce7e2ddab256d17ae964c5e1b20efc366105cec630a90a8bb.js integrity="sha256-F6BS/vZl9Jzn4t2rJW0XrpZMXhsg78NmEFzsYwqQqLs="></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=/docs><span>UAPI group generic documents and meeting minutes</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://uapi-group.org/>‚¨ÖÔ∏è Back to top</a></li><li>‚∏ª</li></ul><ul><li><span>Conferences</span><ul><li><a href=https://uapi-group.org/docs/conferences/2023-02-04__fosdem-devroom/>2023 02 04 Fosdem Devroom</a></li><li><a href=https://uapi-group.org/docs/conferences/2023-02-05_fosdem-kernel-devroom/>2023 02 05 Fosdem Kernel Devroom</a></li><li><a href=https://uapi-group.org/docs/conferences/2023-09-13__all-systems-go/>2023 09 13 All Systems Go</a></li><li><a href=https://uapi-group.org/docs/conferences/2024-02-04_fosdem-kernel-devroom/>2024 02 04 Fosdem Kernel Devroom</a></li><li><a href=https://uapi-group.org/docs/conferences/2024-09-18__lpc-uapi-mc/>2024 09 18 Lpc Uapi MC</a></li><li><a href=https://uapi-group.org/docs/conferences/2024-09-25__all-systems-go/>2024 09 25 All Systems Go</a></li><li><a href=https://uapi-group.org/docs/conferences/2025-02-02__fosdem-devroom/>2025 02 02 Fosdem Devroom</a></li></ul></li><li><span>Minutes</span><ul><li><a href=https://uapi-group.org/docs/minutes/2022-10-05__image-based-linux-summit/>2022 10 05 Image Based Linux Summit</a></li><li><a href=https://uapi-group.org/docs/minutes/2023-09-12__image-based-linux-summit/>2023 09 12 Image Based Linux Summit</a></li><li><a href=https://uapi-group.org/docs/minutes/2024-09-24__image-based-linux-summit/ class=active>2024 09 24 Image Based Linux Summit</a></li></ul></li></ul><ul><li>‚∏ª</li><li><a href=https://github.com/uapi-group/docs target=_blank rel=noopener>Collaborate on Github</a></li></ul></nav><script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/docs/svg/menu.svg class=book-icon alt=Menu></label>
<strong>2024 09 24 Image Based Linux Summit</strong>
<label for=toc-control><img src=/docs/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#attendees-projects>Attendee&rsquo;s projects</a></li><li><a href=#summary-of-last-years-progress>Summary of Last Year‚Äôs Progress</a></li><li><a href=#topics>Topics</a></li><li><a href=#action-items>Action Items</a></li></ul></nav></aside></header><article class=markdown><h1 id=image-based-linux-summit-berlin-24th-september-2024>ÔªøImage-Based Linux Summit Berlin 24th September 2024
<a class=anchor href=#image-based-linux-summit-berlin-24th-september-2024>#</a></h1><h2 id=attendees-projects>Attendee&rsquo;s projects
<a class=anchor href=#attendees-projects>#</a></h2><ul><li>systemd</li><li>mkosi</li><li>SUSE: MicroOS/Tumbleweed</li><li>Red Hat:
<a href=https://osbuild.org>image-builder/osbuild</a>,
<a href=https://github.com/containers/bootc>bootc</a>, systemd, systemd-boot</li><li>Microsoft: confidential containers, Flatcar, Azure Boost, Mariner/Azure Linux</li><li>Edgeless Systems: Constellation,
<a href=https://github.com/edgelesssys/contrast>Contrast</a> (confidential containers),
<a href=https://github.com/edgelesssys/uplosi>uplosi</a></li><li>NixOS: systemd-{repart,stub,boot,cryptenroll}, tvix-store,
<a href=https://github.com/nix-community/lanzaboote>Lanzaboote</a>, UKIs,
<a href=https://github.com/NixOS/rfcs/blob/master/rfcs/0125-bootspec.md>NixOS Bootspec</a>, PE binary manipulation in Rust</li><li>Canonical: Ubuntu Core, snaps, foundations/bootloader/package management</li><li>System Transparency: UKI, UAPI specs, systemd-cryptenroll, remote attestation, TPM eventlog, mkosi</li><li>Freedesktop-sdk</li><li>GNOME OS</li><li>Pengutronix: OE/Yocto, nspawn, RAUC, verity, OPTEE</li><li>Arch Linux: sbctl/go-uefi, signstar, mkinitcpio, arch-install-scripts</li><li><a href=https://postmarketos.org/>PostmarketOS</a></li></ul><h2 id=summary-of-last-years-progress>Summary of Last Year‚Äôs Progress
<a class=anchor href=#summary-of-last-years-progress>#</a></h2><ul><li>Flatcar:<ul><li>Sysexts widely adopted: In-system (shipped with OS), optional but system dependent (updated in lock-step with OS, like podman/ZFS), Custom / user provided (updated from custom servers via sysupdate)</li><li>Composable OS is more flexible, some traction with contributors, even vendors (Akamai)</li><li>Mutable sysexts feature available in systemd-256 and newer. Slowly trickling into distros.</li><li>OS test suite keeps finding bugs in LTS kernel patch-level updates üòÖ</li></ul></li><li>NixOS:<ul><li>Systemd-repart integration to build NixOS images<ul><li>Recent dm-verity support for <code>/nix/store</code> (incl. offline Secure Boot signing support)</li><li>UKI available by default</li><li><a href=https://github.com/nikstur/userborn>https://github.com/nikstur/userborn</a> like sysusers but can create ‚Äúnormal‚Äù users and ‚Äúremove‚Äù users</li><li><a href=https://github.com/nikstur/nix-store-veritysetup-generator>https://github.com/nikstur/nix-store-veritysetup-generator</a> for <code>storehash</code></li></ul></li></ul></li><li>Edgeless:<ul><li>Not much progress on
<a href=https://github.com/uapi-group/specifications/issues/70>package manager lockfile proposal</a></li><li>Talk about reproducible OS image builds with mkosi @ fosdem (
<a href=https://github.com/edgelesssys/reproducible-mkosi>repo</a>)</li><li>uplosi tool for uploading OS images to cloud provider, can pre-calc PCRs for measured boot (started pre-systemd-measure)</li></ul></li><li>openSUSE MicroOS<ul><li>systemd soft-reboot with transactional-update (switching btrfs root subvolume)</li><li>Full disk encryption with systemd-pcrlock / signed policies (TPM and FIDO2)</li><li>Working on BLS support on all architectures</li><li>Systemd-boot integration in YaST2 Installer and all relevant tooling</li></ul></li><li>GNOME OS<ul><li>Significant investment in integrating systemd-homed with GNOME (WIP)</li><li>systemd-sysupdate integration with the GUI app center (GNOME Software)</li><li>Various improvements to systemd-sysupdate (optional components, bug fixes)</li><li>Integration of systemd-sysext into GNOME‚Äôs CI pipelines - testing system components as easy as Flatpaks for apps</li><li>Switch to ukify, drop dracut</li><li>We now use systemd main branch</li></ul></li><li>systemd<ul><li>Tons of stuff, see ASG Thursday</li></ul></li><li>LPC<ul><li>Uapi wishlist room
<a href=https://uapi-group.org/kernel-features/>https://uapi-group.org/kernel-features/</a><ul><li>contributions welcome (via PR)</li></ul></li><li>Session on initrd changes<ul><li>Initrd are quite large with UKIs, need to rm -rf content, tons of work to do, unnecessary</li><li>We have some agreement on umounting initrd from the host</li><li>New root filesystem type as the immutable / (single inode) that can stay around, initrd mounted on top, so it can be removed</li><li>Page-aligned erofs images packed in uncompressed cpio, kernel could zero-copy use them, so we avoid copying/uncompressing on boot</li><li>No agreement on immutable via erofs</li></ul></li></ul></li><li>mkosi<ul><li>Now fully unprivileged (fs generation via systemd-repart)<ul><li>BTRFS work ongoing to do offline compressing/subvolumes</li><li>No more bubblewrap/newuidmap</li><li>mkosi-sandbox instead of bubblewrap</li></ul></li><li>More scripts (version, config)</li><li>Mkosi-initrd as an easy to use tool to build initrds locally</li><li>Various new distributions<ul><li>Azure Linux</li></ul></li><li>OpenSSL engine support for HSM signing</li><li>(signed) shim, systemd-boot, grub support</li><li>Sysupdate support</li></ul></li><li>Red Hat Image Builder / osbuild<ul><li>dm-verity support<ul><li>not yet used in the base image, for automotive use cases</li></ul></li><li>bootc-image-builder:
<a href=https://github.com/osbuild/bootc-image-builder/>https://github.com/osbuild/bootc-image-builder/</a><ul><li>based on rpm-ostree</li></ul></li></ul></li><li><a href=https://uapi-group.org>https://uapi-group.org</a><ul><li>FOSDEM CFP open, will prep a proposal Image Based devroom</li></ul></li><li>Kernel: IPE LSM is now upstream (in v6.12), image-based distros can do code integrity<ul><li>not yet for scripts, there‚Äôs ongoing work for that</li></ul></li></ul><h2 id=topics>Topics
<a class=anchor href=#topics>#</a></h2><ul><li>Dual-booting DPS distros, DPS partition ownership (
<a href=https://github.com/uapi-group/specifications/pull/117>https://github.com/uapi-group/specifications/pull/117</a>)<ul><li>New installer for GNOME OS, no longer supports <code>/etc/fstab</code></li><li>Cannot identify which root/usr partition belongs to which distribution</li><li>home/srv are shareable</li><li>two instances of the same os is not supported</li><li>rootfs discovery is done on pattern matching on labels (implemented in sysupdated, not in the spec yet)</li><li>corresponding /var partition is found via hashing of the machine-id<ul><li>related: mkosi images with integrated /var currently needs a fixed machine-id</li></ul></li><li>Q: Who has adopted DPS in production?<ul><li>Emil: not adopted in SteamOS, as not the full partition set could be discovered</li><li>We can add label-based matching/filtering. There is an open PR for that.</li><li>Need backward compat, if there are no labels do the autodiscovery</li></ul></li><li>People do want to use F39 and want to try F40 and maybe go back, so multiple versions of the same OS can be useful</li><li>Pick the rootfs, then the rest is derived (home shared, var hashed by machine-id)</li><li>Comment: It‚Äôs hard to specify <code>root=</code> with UKI<ul><li>Solution: new credential, TPM locked</li></ul></li><li><code>/etc/os-release</code> add new field, or re-purpose IMAGE_ID</li></ul></li><li>Generic, stateless OpenPGP verification of distribution artifacts (repositories, packages, installation media, updates, etc.)<ul><li>Links:<ul><li><a href=https://github.com/uapi-group/specifications/issues/115>https://github.com/uapi-group/specifications/issues/115</a></li><li><a href=https://github.com/systemd/mkosi/issues/3042>https://github.com/systemd/mkosi/issues/3042</a></li><li><a href=https://codeberg.org/heiko/rsop>https://codeberg.org/heiko/rsop</a></li></ul></li><li>Tons of pitfalls, gpg not standard compliant anymore, is not stateless with regards to keyrings</li><li>Would be great to have stateless (no keyring) thingy for signatures</li><li>why not PKCS#7</li><li>Apt has global <code>trusted.gpg.d</code> directory, being phased out, specified inline in the src line</li><li>seems similar to how distros handle TLS certificates differently</li><li>systemd currently could use this for verity authentication and downloading</li><li>suggestion: write a UAPI spec (agnostic with regards to OpenPGP or PKCS#7 or SSH?)<ul><li>PKCS#7 is x509 so that additional things can be added, like application-specific purpose extensions</li><li><a href=https://datatracker.ietf.org/doc/html/rfc5280#section-4.2.1.12>https://datatracker.ietf.org/doc/html/rfc5280#section-4.2.1.12</a></li></ul></li><li>Spec says where to put keys, how to name them</li><li>Key need a purpose, path specifies it, so that a key cannot be used to add trust to another key, only to a repo</li><li>Should support the usual <code>/usr/</code>, <code>/etc/</code>, <code>/run/</code> priorities</li><li>Directory structure should be used to find the right key (apt key or sysupdate key), but key policy should be inside the key (signing key or bla key)<ul><li>find key type from the file name suffix</li></ul></li><li>Not turn it into a Certificate Store thing, like openssl</li><li>Have a way to find a private key corresponding to a public key</li><li>Reserve some OIDs for usage, or define usage extension fields</li></ul></li><li>would like to add a security feature (BPF LSM) to reject any access to an unauthenticated FS<ul><li>dm-verity/dm-crypt or fixed list (sys, proc, ‚Ä¶)</li><li>also reject any dev nodes outside of /dev<ul><li>chromeos has something similar</li></ul></li><li>Reject <code>AF_UNIX</code> sockets in <code>/etc/</code> or <code>/usr/</code></li><li>Any other ‚Äúno-brainer‚Äù security policies we should add globally?</li><li>TODO: file RFE on systemd to track list of policies</li><li>BPF LSMs are often closed-source currently</li><li>Make program visible in BPF FS when loaded, so you can do <code>ConditionPathExists=/sys/filesystem/bpf</code> (TODO: fix this)</li></ul></li><li>Think about the relation between FIDO2 + TPM2 (tpm2+fido2 as PIN, TPM2 and FIDO2 as recovery key)<ul><li>No two factor auth, it‚Äôs either TPM or FIDO</li><li>Chromeos makes the tpm send a challenge to the fido device, then the TPM reveals the encryption key<ul><li>could likely also be used with PKCS#7 HSMs</li></ul></li><li>SSS (Shamir Secret Sharing) support was being worked on, but keys are combined in software on the CPU, so the spooks can get at you</li><li>SSH agent could also use this scheme</li><li>TPM policy expresses that there must be a challenge-answer</li><li>Q: use this for remote proof of identity?<ul><li>we have PCR15, which includes machine-id and could have other identity identifiers</li></ul></li></ul></li><li>immutable without significantly raising the bar for contributors<ul><li><a href=https://gitlab.com/postmarketOS/postmarketos/-/issues/62#note_2095562422>https://gitlab.com/postmarketOS/postmarketos/-/issues/62#note_2095562422</a></li><li>How to deliver an immutable system without raising complexity</li><li>Need to figure out how to build image<ul><li>Image build efficiency: composefs</li></ul></li><li>Q: how about sysexts?<ul><li>Thilo: there are plans to load sysexts very early (initramfs). Also can create systexts on the fly - using mutable overlays and capturing the writes in a separate ‚Äúworking‚Äù directory, then building a new sysext from that</li></ul></li><li>perhaps do an overlayfs and keep a list of user-installed packages?</li><li>This completely breaks the security model<ul><li>For developers, it makes sense for a ‚Äúbreak glass‚Äù mechanism to do things locally</li><li>For users, the update mechanism should be designed with security in mind and do transactional updates</li><li>Think hard on whether the immutable system is the right approach for the use case</li></ul></li><li>a way would be to use local keys to build images locally. but uses the full image workflow.</li><li>They currently use apk and install packages into an overlayfs, purely additive. the overlayfs would become incompatible on update, so nuke it.</li><li>This kind of issue will become bigger when moving to UKI.<ul><li>Seems like using measured boot is much more interesting than secure boot.</li></ul></li><li>Perhaps mkosi approach, keep a list of packages and generate a locally signed sysext. then refresh the sysext<ul><li>Just build the full image locally, no need for sysext if you can sign everything yourself</li></ul></li><li>maybe have a ‚Äúdeveloper mode‚Äù like chromeos. there is an entry in the systemd todo list<ul><li>gnome os is looking at this as well</li><li>have an explicit knob in the TPM for this</li><li>NIXOS has a similar mode</li></ul></li><li>On qualcomm phones there is no way to have a fTPM in TrustZone</li></ul></li><li>systemd on musl<ul><li><a href=https://catfox.life/2024/09/05/porting-systemd-to-musl-libc-powered-linux/>https://catfox.life/2024/09/05/porting-systemd-to-musl-libc-powered-linux/</a></li><li>pmOS is for smartphones, they have a high number of contributors relative to the number of users</li><li>Tons of patches</li><li>We merged some patches<ul><li>they (adelie folks) use s6 parts to support group shadow stuff that‚Äôs required by systemd</li></ul></li><li>have a shim library when using systemd on musl<ul><li><code>pidfd_spawn</code>, shadow/gshadow, <code>printf</code> string formatter, detected by pkgconfig</li><li>Maintain shadow parser and printf in parallel with musl</li><li>needs to be done by libc experts</li><li>systemd adds more nss stuff (userdb), might be considered advanced use cases</li></ul></li><li>locale support in musl is problematic (tests fail)<ul><li>there is conditional execution of tests in systemd already (e.g. when running in a container)</li></ul></li><li>Q: how is pmOS handling network<ul><li>A: NetworkManager, due to switching between mobile and wifi</li><li>GUIs are also deeply integrated with NetworkManager</li></ul></li><li>be careful with musl on memory constrained systems, as they don‚Äôt release memory back to the OS</li></ul></li><li>Missing functionality for managing <code>/etc/</code> as a writable confext<ul><li>Persisting <code>/etc/machine-id</code></li><li>Deriving the machine-id for <code>/var/</code>, even though <code>/var/</code> is probably storing the mutable <code>/etc/</code> context</li><li>Handling presets. Store them in <code>/usr/</code> somehow?</li><li>Possible solution: Just mount <code>/var/</code> from initrd? (Who does this actually affect, and do they use image-based / confexts / whatever?)</li><li>Move mounts that exist on <code>/etc/</code> when reapplying, writable <code>/etc/</code> on top of the stack</li><li>Overlayfs works by using the superblock for each elements, pins it, and doesn‚Äôt look at the VFS at all, so it needs to be handled by the confext layer</li><li>How to handle cases where only <code>/var/</code> should be persisted?<ul><li>repart uses the ephemeral machine-id to create <code>/var/</code></li><li>there is now also <code>systemd.machine-id=firmware</code></li><li>Could add a mechanism to persist machine-id via tpm (NV index, allows factory reset) or system credential</li><li>could also use the <code>/var/</code> partition UUID as machine-id?<ul><li>problematic from the security perspective, needs some authentication</li></ul></li></ul></li><li>perhaps reopen the discussion to mount <code>/var/</code> early (in the initramfs)<ul><li>MicroOS already mounts <code>/var/</code> (and <code>/etc/</code> overlay) in the initrd</li><li>things are a bit tricky around soft-reboot because there is no initrd</li></ul></li></ul></li><li>Support for CC-based (confidential computing) runtime measurements (i.e. &ldquo;PCRs&rdquo;) in systemd-stub, systemd-pcr*<ul><li>Most systems have vTPM</li><li>Should systemd support this if it detects CVM?<ul><li>problematic for Intel, as they do it differently compared to everyone else<ul><li>looks like they will move to a TPM API as well</li></ul></li></ul></li><li>separate PCRs are required for disk encryption via TPM policies, not needed for remote attestation</li><li>sd stub already supports some CC measurement log</li><li>Use case: runtime generalised measurements<ul><li>Stuff we build in systemd are not ima based</li></ul></li><li>Industry largely is accepting that vTPM is the interface to provide to the OS<ul><li>If userspace uses the 4 intel registers to map to the 4 PCRs systemd uses, this could be hacked to work</li></ul></li><li>for very minimal/fixed userspace, tpm might not be needed, as everything can be measured at the start</li></ul></li><li>Unpriv container support/mountfsd<ul><li>newuidmap is bad</li><li>We have mountfsd/nsresourced</li><li>Doesn‚Äôt work with containers in the home directory</li><li>Extend mountfsd to get file descriptor of directory instead of image file</li><li>Predefine 65k users for containers, no dynamic, no system specific, always the same, statically</li><li>mountfsd enforces that the setup matches, then checks the parent inode to check that the caller owns it, then set up id mapped mount</li><li>Dynamic ranges get mapped to this static range</li><li>Homed already uses id mapping, kernel doesn‚Äôt allow nesting. This will be fixed in the kernel to allow multiple mappings.</li><li>FreeIPA has existing systems with large amounts of mapping, want to make it configurable<ul><li>But if OCI tarballs have to be built offline, no way to synchronise them</li></ul></li><li>Mountfsd also needs to learn to delete them, as unpriv users cannot delete files they do not own</li><li>Once available this may be used for mkosi too</li><li>IPC is via a varlink unix socket, so they could be used in containers as well via a bind mount</li></ul></li><li>Partition resizing discussion<ul><li>Should repart start resizing filesystems on its own?</li><li>There‚Äôs nothing to resize vfat. What do we do if we want to grow the ESP?</li><li>Gnome OS wants to use repart for the installer</li><li>don‚Äôt resize ESP. use xbootloader</li><li>Android uses dm-linear to runtime-merge partitions</li><li>DPS GPT flag for extension partition to concatenate them with dm-linear<ul><li>Difficult to implement in repart for the allocation algorithm</li></ul></li><li>related: fuchsia has a
<a href=https://fuchsia.dev/fuchsia-src/concepts/filesystems/blobfs>blobfs</a>, which makes everything accessible via a rootfs</li></ul></li><li>Confext dm-crypt+dm-verity loop<ul><li>End goal: being able to reason about every single inode on the system, with different owners/signers per component</li><li>Agree with this, an issue with composefs because of the multiple layers</li></ul></li><li>Hermetic <code>/usr/</code> + Hermetic <code>/etc/</code><ul><li>Easy parts done for MicroOS</li><li>Some projects can‚Äôt have their files split, some refuse patches (some quite rudely)</li><li>glibc would take patches, but they don‚Äôt want to do the work and it needs to be reimplemented in glibc</li><li>MicroOS currently targets putting everything in <code>/usr/etc/</code> and only using that as a fallback if sysadmins don‚Äôt put a file in <code>/etc/</code> (
<a href=https://github.com/openSUSE/libnss_usrfiles>libnss_usrfiles</a>)</li><li>tmpfiles + <code>/usr/share/factory/etc/</code> + symlinks seems to work great</li><li>suggest using volatile /etc and have an allow list for specific stuff</li><li>for the base os we should be fine now (on fedora), except <code>/etc/services</code><ul><li>MicroOS doesn‚Äôt have <code>/etc/services</code> any more</li><li>related: <code>/etc/protocols</code></li></ul></li><li><code>/etc/shells</code> is read by many things directly<ul><li>use tmpfiles to create a symlink</li></ul></li><li>for glibc, most important is ldconfig, services, nsswitch.conf<ul><li><a href=https://github.com/systemd/systemd/pull/34535>https://github.com/systemd/systemd/pull/34535</a></li></ul></li><li><a href=https://github.com/authselect/authselect/pull/380>https://github.com/authselect/authselect/pull/380</a></li><li>it would be nice if overlayfs had a way to ‚Äúreveal‚Äù (config) files from the lower layers<ul><li>you can diff between upper and lower layers</li></ul></li><li>Do we need a arewehermeticyet page? (there‚Äôs no ‚Äú.yet‚Äù tld though)<ul><li>Yes</li><li>Tracker:
<a href=https://github.com/uapi-group/specifications/issues/76>https://github.com/uapi-group/specifications/issues/76</a> (is now a pinned issue)</li><li>maybe complain about packages which place files in <code>/etc/</code>?</li><li>How to test whether packages?</li><li>nix patches all packages which write to <code>/etc/</code>, can be used as a list of affected packages</li><li>list of stuff that needs to be in <code>/etc/</code> on Arch Linux:
<a href=https://github.com/systemd/particleos/blob/main/mkosi.extra/usr/lib/tmpfiles.d/etc.conf>https://github.com/systemd/particleos/blob/main/mkosi.extra/usr/lib/tmpfiles.d/etc.conf</a></li></ul></li><li>also relates to random top-level paths (mount points in <code>/</code>, container usecases, <code>/opt/</code>)</li></ul></li><li>OS Factory Reset<ul><li>What to do with user content on the ESP (credentials, self-signed UKIs)?</li><li>Original patch set for factory reset became purge, which then tried to delete home directories, which made some people unhappy<ul><li><a href=https://github.com/systemd/systemd/pull/24983>https://github.com/systemd/systemd/pull/24983</a></li></ul></li><li>Need to factory reset TPM<ul><li>There is an API for userspace to request this on reboot</li></ul></li><li>There should be a way to request factory reset from the boot menu<ul><li>that then triggers repart factory reset, TPM reset and something like bootctl factory-reset</li></ul></li><li>Should we have global directories to sort things by owner?</li><li>Undecidable whether e.g. nVidia drivers should be removed or not, might be required for graphics to work, but maybe the factory reset was initiated to get rid of them</li><li>let‚Äôs add a vendor directory that does not get deleted</li></ul></li><li>systemd-pcrlock<ul><li>Canonical wrote a whitepaper on PCR-based unlock, but it has not been published yet</li><li>TODO: ask to get it published</li><li>SUSE has adopted pcrlock<ul><li>Their older Dell laptops don‚Äôt support NV index policies</li><li>The problem will resolve itself by waiting, until then we need graceful fallbacks</li></ul></li><li>Order of measurement is deterministic by PCR, but not globally across all PCRs</li><li>Golden measurements supported, provided by vendor (in <code>/usr/</code>), derive the rest from hardware<ul><li>some laptop vendors provide PCR0 values for LFVS, but the actual measurement values would be better</li><li>Ideally would supply measurements in the json format for other PCRs touched to the firmware</li></ul></li><li>pcrlock is not very user friendly<ul><li>Should have documentation pointing users to the obvious defaults that they should pick</li><li><code>--lock=auto</code> option like cryptenroll</li><li>pcrlock status, like bootctl show what local hardware supports</li></ul></li><li>pcrlock in combination with signed pcr policies is fixed in v257 via key sharding</li></ul></li><li>Recovery key fallback<ul><li>Windows doesn‚Äôt do much user-friendly stuff, nobody knows their bitlocker recovery key</li><li>GNOME OS: show GUI when measurements change, to tell the user ‚Äòsomething‚Äô happened, which PCR is different</li><li>pcrlock will find a measurement that it can‚Äôt make sense of in the log</li><li>No verb to machine-readable output, can be added</li><li>This is the remote attestation problem, as you cannot trust the output of a machine booting a compromised kernel</li><li>There was a bluetooth based project to tie this to a phone (FOSDEM ?? Ultrablue)<ul><li><a href=https://github.com/ANSSI-FR/ultrablue>https://github.com/ANSSI-FR/ultrablue</a></li><li>User-friendly Lightweight TPM Remote Attestation over Bluetooth
<a href=https://archive.fosdem.org/2023/schedule/event/image_linux_secureboot_ultrablue/>https://archive.fosdem.org/2023/schedule/event/image_linux_secureboot_ultrablue/</a></li></ul></li></ul></li><li>Delivering credentials via systemd-creds to initrd for non-UKI systems (type#1)?<ul><li>Define UEFI protocol to pass sidecars to sd-stub, which will look for it together with the filesystem-based ones</li><li>Ostree adds a new menu entry on each system update</li><li>Btrfs creates a new snapshot on any change to the rootfs (update, config changes, etc)</li><li>Nixos creates a new entry every time the system config changes</li><li>Can a credential be used instead of the kernel command line?<ul><li>Problem is GUI: we need a chooser in the menu</li><li>By opening up the kernel command line choice, we need to ensure we are not opening up a security hole to let a user access the root user</li></ul></li></ul></li></ul><h2 id=action-items>Action Items
<a class=anchor href=#action-items>#</a></h2><ul><li>file RFE on systemd to track list of BPF LSM filesystem lockdown policies</li><li>Make program visible in BPF FS when loaded, so you can do <code>ConditionPathExists=/sys/filesystem/bpf</code></li><li>ask for Canonical whitepaper on PCR-based unlock to be published</li><li>writeup for LWN, send draft to group</li><li>CFP for FOSDEM for image-based devroom</li><li>organise 4th summit next year<ul><li><a href=https://www.bmw-berlin-marathon.com/en/>CHECK BERLIN MARATHON DATES</a></li><li>Try after ASG, if we can do ASG Tue/Wed</li></ul></li><li>mastodon posts about systemd v257 features</li><li>add stuff to kernel features wishlist</li><li>file ‚Äúuser friendly pcrlock‚Äù issue</li><li><code>uki.d</code> vs <code>uki.vendor.d</code> dropins for factory reset</li><li>create PR for certificate directory structure</li><li>make suggestions on other projects to invite (use Signal)</li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/uapi-group/docs/edit/main/minutes/2024-09-24__Image-based-linux-summit.md target=_blank rel=noopener><img src=/docs/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#attendees-projects>Attendee&rsquo;s projects</a></li><li><a href=#summary-of-last-years-progress>Summary of Last Year‚Äôs Progress</a></li><li><a href=#topics>Topics</a></li><li><a href=#action-items>Action Items</a></li></ul></nav></div></aside></main></body></html>